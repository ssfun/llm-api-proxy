# LLM API Proxy

[](https://opensource.org/licenses/MIT)
[](https://workers.cloudflare.com/)
[](https://www.google.com/search?q=CONTRIBUTING.md)

ä¸€ä¸ªéƒ¨ç½²åœ¨ Cloudflare Workers ä¸Šçš„ä¼ä¸šçº§ã€é«˜éšç§ã€æ™ºèƒ½ LLM API ä»£ç†ç½‘å…³ã€‚

## ğŸ“– é¡¹ç›®ç®€ä»‹

`LLM API Proxy` æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ API ä»£ç†è§£å†³æ–¹æ¡ˆï¼Œæ—¨åœ¨ä¸ºå¼€å‘è€…æä¾›ä¸€ä¸ªå®‰å…¨ã€é«˜æ•ˆã€å¯æ§çš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰API è®¿é—®å±‚ã€‚é€šè¿‡éƒ¨ç½²åœ¨ Cloudflare çš„å…¨çƒè¾¹ç¼˜ç½‘ç»œä¸Šï¼Œå®ƒä¸ä»…èƒ½åŠ é€Ÿæ‚¨çš„ API è¯·æ±‚ï¼Œè¿˜èƒ½é€šè¿‡ç‹¬ç‰¹çš„æŠ€æœ¯å®ç°æè‡´çš„éšç§ä¿æŠ¤ï¼Œå¹¶ä¸ºç‰¹å®šæ¨¡å‹ï¼ˆå¦‚ Google Geminiï¼‰æä¾›å¢å¼ºçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚

æ— è®ºæ‚¨æ˜¯å¸Œæœ›ä¿æŠ¤ API å¯†é’¥ã€ç®€åŒ–å®¢æˆ·ç«¯é…ç½®ã€è¿˜æ˜¯ç¡®ä¿å¤æ‚æ¨ç†ä»»åŠ¡ä¸ä¸­æ–­ï¼Œ`LLM API Proxy` éƒ½èƒ½æä¾›å“è¶Šçš„è§£å†³æ–¹æ¡ˆã€‚

![é¡¹ç›®ä¸»é¡µ](https://github.com/ssfun/llm-api-proxy/blob/main/Preview.png?raw=true)

## âœ¨ æ ¸å¿ƒç‰¹æ€§

  * **ğŸ›¡ï¸ æè‡´çš„éšç§ä¿æŠ¤**

      * é€šè¿‡ Cloudflare çš„ `connect()` API å®ç°åŸç”Ÿ TCP Socket è¿æ¥ï¼Œè¯·æ±‚ç›´è¾¾ç›®æ ‡æœåŠ¡å™¨ï¼Œ**å®Œå…¨æ¶ˆé™¤äº† `cf-*`ã€`x-forwarded-for` ç­‰ä»»ä½•å¯èƒ½æ³„éœ²å®¢æˆ·ç«¯çœŸå® IP å’Œä¸­é—´äººä¿¡æ¯çš„è¯·æ±‚å¤´**ï¼Œå®ç°äº†çœŸæ­£çš„é›¶éšç§æ³„éœ²ã€‚
      * ä¸ä¼ ç»Ÿçš„ `fetch` ä»£ç†ç›¸æ¯”ï¼Œéšç§ä¿æŠ¤èƒ½åŠ›æ›´èƒœä¸€ç­¹ã€‚

  * **âœ¨ å¼ºå¤§çš„ Gemini ä¼˜åŒ–**

      * å†…ç½®ä¸º Google Gemini API å®šåˆ¶çš„**æ™ºèƒ½æµå¼å“åº”æ¢å¤æœºåˆ¶**ã€‚
      * å½“â€œæ€ç»´é“¾ï¼ˆChain-of-thoughtï¼‰â€ç­‰é•¿ç¯‡å†…å®¹ç”Ÿæˆå› ç½‘ç»œé—®é¢˜ä¸­æ–­æ—¶ï¼Œä»£ç†ä¼šè‡ªåŠ¨æ£€æµ‹ã€ä¿ç•™ä¸Šä¸‹æ–‡å¹¶å‘èµ·ç»­å†™è¯·æ±‚ï¼Œç¡®ä¿æ¨ç†çš„å®Œæ•´æ€§ã€‚
      * æ”¯æŒ\*\*å¤šè¯­è¨€ï¼ˆä¸­/è‹±/æ—¥/éŸ©ç­‰ï¼‰\*\*è‡ªåŠ¨æ£€æµ‹å’Œç›¸åº”çš„ç»­å†™æç¤ºï¼Œé¿å…è¯­è¨€æ··æ·†ã€‚

  * **âš¡ æ™ºèƒ½è¿æ¥ç­–ç•¥**

      * é»˜è®¤é‡‡ç”¨ **Socket ä¼˜å…ˆ**ç­–ç•¥ï¼Œåœ¨è¿½æ±‚æè‡´éšç§çš„åŒæ—¶ï¼Œå½“é‡åˆ°ä¸å…¼å®¹çš„ç½‘ç»œç¯å¢ƒæ—¶ï¼Œä¼šè‡ªåŠ¨æ— ç¼å›é€€åˆ° `Fetch` ç­–ç•¥ï¼Œå…¼é¡¾éšç§ä¸å¯ç”¨æ€§ã€‚
      * æ”¯æŒä¸ºç‰¹å®š API ç«¯ç‚¹ï¼ˆå¦‚ OpenAI, Claude ç­‰ä½¿ç”¨ Cloudflare ç½‘ç»œï¼Œä¸æ”¯æŒ TCP Socket è¿æ¥çš„ API æœåŠ¡å•†ï¼‰å¼ºåˆ¶é…ç½® `Fetch` ç­–ç•¥ï¼Œä»¥è·å¾—æœ€ä½³å…¼å®¹æ€§ã€‚
      * API ç«¯ç‚¹æ”¯æŒä»¥æ•°ç»„çš„å½¢å¼é…ç½®å¤šä¸ªä¸Šæ¸¸ targets ï¼Œå®ç°éšæœºè°ƒç”¨ã€‚
      * å»ºè®®ä¸º OpenAI, Claude ç­‰ä½¿ç”¨ Cloudflare ç½‘ç»œçš„ API æœåŠ¡å•†å•ç‹¬éƒ¨ç½² [Supabase API ç½‘å…³(å¾…è¡¥å……)](https://github.com/ssfun)ï¼Œå®ç°æ›´å¥½çš„éšç§ä¿æŠ¤ã€‚

  * **ğŸš€ çµæ´»çš„è·¯ç”±æ¨¡å¼**

      * **é¢„è®¾ç«¯ç‚¹æ¨¡å¼**ï¼šä¸ºæ•°åç§ä¸»æµ LLM æœåŠ¡ï¼ˆOpenAI, Anthropic, Google, Groq ç­‰ï¼‰é¢„è®¾äº†ç®€çŸ­çš„è®¿é—®è·¯å¾„ï¼Œç®€åŒ–å®¢æˆ·ç«¯é…ç½®ã€‚
      * **é€šç”¨ä»£ç†æ¨¡å¼**ï¼šé€šè¿‡æˆæƒä»¤ç‰Œï¼Œå¯å°†æ­¤ Worker ä½œä¸ºä¸€ä¸ªç§æœ‰çš„ã€å®‰å…¨çš„ä»£ç†ï¼Œè½¬å‘åˆ°äº’è”ç½‘ä¸Šä»»ä½•ä¸€ä¸ª HTTP/HTTPS APIã€‚

  * **ğŸ”§ ä¸°å¯Œçš„å¯é…ç½®æ€§**

      * æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å‡å¯é€šè¿‡ Cloudflare Worker çš„**ç¯å¢ƒå˜é‡**è¿›è¡Œé…ç½®ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä¸€é”®å¼€å¯å¯¹é¢„è®¾ç«¯ç‚¹çš„å¼ºåˆ¶è®¤è¯ï¼Œæˆ–å…³é—­ Gemini çš„ç‰¹æ®Šä¼˜åŒ–ã€‚

  * **ğŸŒ å…¨åè®®æ”¯æŒ**

      * å®Œæ•´æ”¯æŒ `HTTP/HTTPS` åè®®çš„ä»£ç†ã€‚
      * å®Œæ•´æ”¯æŒ `WebSocket` åè®®çš„ä»£ç†ï¼Œé€‚ç”¨äºéœ€è¦å®æ—¶é€šä¿¡çš„åœºæ™¯ã€‚

  * **ğŸ“Š ç²¾ç¾çš„ä»ªè¡¨ç›˜**

      * è®¿é—® Worker æ ¹ç›®å½•å³å¯çœ‹åˆ°ä¸€ä¸ªåŠŸèƒ½é½å…¨ã€è®¾è®¡ç²¾ç¾çš„ä»ªè¡¨ç›˜ï¼Œç›´è§‚å±•ç¤ºäº†æ‰€æœ‰é¢„è®¾ç«¯ç‚¹ã€åŠŸèƒ½ç‰¹æ€§å’Œè¯¦ç»†çš„ä½¿ç”¨è¯´æ˜ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹ / éƒ¨ç½²æŒ‡å—

éƒ¨ç½²è¯¥é¡¹ç›®éå¸¸ç®€å•ï¼Œå…¨ç¨‹æ— éœ€å¤æ‚çš„å‘½ä»¤è¡Œæ“ä½œã€‚

#### å‰ææ¡ä»¶

  * ä¸€ä¸ª [Cloudflare](https://www.cloudflare.com/) è´¦æˆ·ã€‚

#### éƒ¨ç½²æ­¥éª¤

1.  **åˆ›å»º Worker æœåŠ¡**

      * ç™»å½•æ‚¨çš„ Cloudflare ä»ªè¡¨ç›˜ã€‚
      * åœ¨å·¦ä¾§èœå•ä¸­ï¼Œè½¬åˆ° **Workers & Pages**ã€‚
      * ç‚¹å‡» **Create application** \> **Create Worker**ã€‚
      * ä¸ºæ‚¨çš„ Worker æŒ‡å®šä¸€ä¸ªå­åŸŸåï¼ˆä¾‹å¦‚ `my-llm-proxy`ï¼‰ï¼Œç„¶åç‚¹å‡» **Deploy**ã€‚

2.  **ç²˜è´´ä»£ç **

      * éƒ¨ç½²åï¼Œç‚¹å‡» **Edit code** è¿›å…¥åœ¨çº¿ç¼–è¾‘å™¨ã€‚
      * å°†æœ¬é¡¹ç›® `worker.js` æ–‡ä»¶ä¸­çš„**å…¨éƒ¨ä»£ç **å¤åˆ¶å¹¶ç²˜è´´åˆ°ç¼–è¾‘å™¨ä¸­ï¼Œè¦†ç›–åŸæœ‰å†…å®¹ã€‚

3.  **é…ç½®ç¯å¢ƒå˜é‡**

      * åœ¨ç¼–è¾‘å™¨é¡µé¢ï¼Œè¿”å› Worker çš„ä¸»é…ç½®é¡µï¼ˆç‚¹å‡»é¡¶éƒ¨çš„ Worker åç§°ï¼‰ã€‚
      * è½¬åˆ° **Settings** \> **Variables** \> **Environment Variables**ï¼Œç‚¹å‡» **Add variable**ã€‚
      * æ ¹æ®ä¸‹æ–¹çš„ç¯å¢ƒå˜é‡è¯¦è§£ï¼Œæ·»åŠ æ‚¨éœ€è¦çš„é…ç½®ã€‚**å¼ºçƒˆå»ºè®®**æ‚¨é¦–å…ˆè®¾ç½®ä¸€ä¸ªå®‰å…¨çš„ `AUTH_TOKEN`ã€‚
      * ç‚¹å‡» **Save and Deploy**ã€‚

4.  **å®Œæˆï¼**

      * æ‚¨çš„ `LLM API Proxy` ç°åœ¨å·²ç»æˆåŠŸéƒ¨ç½²å¹¶è¿è¡Œåœ¨ `https://<your-worker-name>.<your-subdomain>.workers.dev` ä¸Šã€‚

## âš™ï¸ ç¯å¢ƒå˜é‡è¯¦è§£

é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡æ¥æ§åˆ¶ä»£ç†çš„è¡Œä¸ºã€‚

| å˜é‡å                            | è¯´æ˜                                                                             | é»˜è®¤å€¼                  | ç¤ºä¾‹                               |
| --------------------------------- | -------------------------------------------------------------------------------- | ----------------------- | ---------------------------------- |
| **`AUTH_TOKEN`** | **ï¼ˆå¿…éœ€ï¼‰** ç”¨äºé€šç”¨ä»£ç†æ¨¡å¼å’Œé¢„è®¾ç«¯ç‚¹è®¤è¯çš„å®‰å…¨ä»¤ç‰Œã€‚è¯·åŠ¡å¿…ä¿®æ”¹ä¸ºä¸€ä¸ªå¤æ‚çš„å­—ç¬¦ä¸²ã€‚ | `"your-auth-token"`     | `"client"`        |
| `PRESET_AUTH_ENABLED`             | æ˜¯å¦å¯¹æ‰€æœ‰é¢„è®¾ç«¯ç‚¹ï¼ˆå¦‚ `/openai`ï¼‰å¼ºåˆ¶å¯ç”¨ `AUTH_TOKEN` è®¤è¯ã€‚                     | `false`                 | `true`                             |
| `GEMINI_SPECIAL_HANDLING_ENABLED` | æ˜¯å¦ä¸º `/gemini` ç«¯ç‚¹å¯ç”¨ç‰¹æ®Šçš„æ™ºèƒ½é‡è¯•å’Œæµå¼æ¢å¤é€»è¾‘ã€‚                          | `true`                  | `false`                            |
| `DEBUG_MODE`                      | æ˜¯å¦å¼€å¯è°ƒè¯•æ¨¡å¼ã€‚å¼€å¯åï¼Œä¼šåœ¨æ—¥å¿—ä¸­è¾“å‡ºæ›´è¯¦ç»†çš„è¿æ¥ä¿¡æ¯ã€‚                         | `false`                 | `true`                             |
| `AGGRESSIVE_FALLBACK`             | æ˜¯å¦å¼€å¯æ¿€è¿›å›é€€æ¨¡å¼ã€‚å¼€å¯åï¼Œä»»ä½• Socket è¿æ¥å¤±è´¥éƒ½ä¼šå°è¯•å›é€€åˆ° Fetchã€‚           | `true`                  | `false`                            |
| `GEMINI_RETRY_PROMPT_CN`          | è‡ªå®šä¹‰ Gemini ç»­å†™æ—¶çš„ä¸­æ–‡æç¤ºã€‚                                                 | (å†…ç½®é»˜è®¤å€¼)            | `"è¯·ä»ä¸­æ–­å¤„ç»§ç»­"`                 |
| `GEMINI_RETRY_PROMPT_EN`          | è‡ªå®šä¹‰ Gemini ç»­å†™æ—¶çš„è‹±æ–‡æç¤ºã€‚                                                 | (å†…ç½®é»˜è®¤å€¼)            | `"Continue from where you left off"` |

## ğŸ•¹ï¸ ä½¿ç”¨æ–¹æ³•

### 1\. é¢„è®¾ç«¯ç‚¹æ¨¡å¼ (Preset Endpoint Mode)

ç›´æ¥ä½¿ç”¨ç®€çŸ­çš„è·¯å¾„è®¿é—®ä¸»æµ LLM æœåŠ¡ã€‚

  * **é»˜è®¤ï¼ˆå…¬å¼€è®¿é—®ï¼‰**ï¼š

    ```bash
    curl https://<your-worker-url>/openai/v1/chat/completions \
      -H "Authorization: Bearer $OPENAI_API_KEY" \
      -H "Content-Type: application/json" \
      -d '{
        "model": "gpt-4-turbo",
        "messages": [{"role": "user", "content": "Hello!"}]
      }'
    ```

  * **å¼€å¯ `PRESET_AUTH_ENABLED` åï¼ˆç§æœ‰è®¿é—®ï¼‰**ï¼š

    ```bash
    # URL è·¯å¾„å‰éœ€è¦åŠ ä¸Šä½ çš„ AUTH_TOKEN
    curl https://<your-worker-url>/<AUTH_TOKEN>/openai/v1/chat/completions \
      -H "Authorization: Bearer $OPENAI_API_KEY" \
      ...
    ```

### 2\. é€šç”¨ä»£ç†æ¨¡å¼ (Generic Proxy Mode)

ä»£ç†ä»»æ„ APIï¼ŒURL æ ¼å¼ä¸ºï¼š `https://<worker-url>/<AUTH_TOKEN>/<ç›®æ ‡URLåè®®>/<ç›®æ ‡URLåŸŸå>/<è·¯å¾„>`

```bash
# ä»£ç† https://api.ipify.org?format=json
curl https://<your-worker-url>/<AUTH_TOKEN>/https/api.ipify.org?format=json

# å“åº”: {"ip":"x.x.x.x"}
```

### 3\. WebSocket ä»£ç†

URL æ ¼å¼ä¸ºï¼š`wss://<worker-url>/<AUTH_TOKEN>/<ç›®æ ‡WSSåè®®>/<ç›®æ ‡WSSåŸŸå>/<è·¯å¾„>`

```javascript
// JavaScript å®¢æˆ·ç«¯ç¤ºä¾‹
const ws = new WebSocket(
  'wss://<your-worker-url>/<AUTH_TOKEN>/wss/echo.websocket.org'
);

ws.onopen = () => {
  console.log('WebSocket è¿æ¥å·²å»ºç«‹');
  ws.send('Hello from LLM API Proxy!');
};

ws.onmessage = (event) => {
  console.log('æ”¶åˆ°æ¶ˆæ¯: ', event.data);
};
```
## ğŸ™ é¸£è°¢

- [@XyzenSun](https://github.com/XyzenSun/SpectreProxy) çš„ SpectreProxy é¡¹ç›®ï¼Œæœ¬é¡¹ç›®åŸºäºæ­¤é«˜åº¦å®šåˆ¶

- [@kev1npros](https://linux.do/t/topic/861821) ã€ [@Shikha](https://linux.do/t/topic/864744) çš„ Gemini é˜²æˆªæ–­æ–¹æ¡ˆ

## ğŸ¤ è´¡çŒ®

æ¬¢è¿ä»»ä½•å½¢å¼çš„è´¡çŒ®ï¼å¦‚æœæ‚¨æœ‰ä»»ä½•æƒ³æ³•ã€å»ºè®®æˆ–å‘ç°äº† Bugï¼Œè¯·éšæ—¶æäº¤ [Issues](https://www.google.com/search?q=https://github.com/your-repo/llm-api-proxy/issues) æˆ– [Pull Requests](https://www.google.com/search?q=https://github.com/your-repo/llm-api-proxy/pulls)ã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº [MIT License](https://www.google.com/search?q=LICENSE) å¼€æºã€‚
